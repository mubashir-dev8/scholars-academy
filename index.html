<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>Scholars Academy</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script type="module" src="firebase.js"></script>

  <style>
    /* Processing overlay */
    #processingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99999;
    }

    #processingOverlay[aria-hidden="false"] {
      display: flex;
    }

    .processing-modal {
      background: #fff;
      padding: 18px 22px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.35);
      display: flex;
      gap: 14px;
      align-items: center;
      min-width: 260px;
      max-width: 90%;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    .processing-spinner {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 4px solid rgba(0, 0, 0, 0.12);
      border-top-color: #0b6cff;
      animation: spin 1s linear infinite;
      flex: 0 0 36px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .processing-text {
      font-size: 15px;
      line-height: 1.2;
      color: #111;
    }

    .processing-sub {
      font-size: 12px;
      color: #666;
      margin-top: 6px;
    }

    /* Keep accessibility focus outline visible if needed */
    .visually-hidden {
      position: absolute !important;
      height: 1px;
      width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <!-- ===== TOP NAV with Hamburger (replaces old nav bar) ===== -->
  <header>
    <nav class="top-nav" role="navigation" aria-label="Main">
      <button id="hamburgerBtn" class="hamburger" aria-controls="navMenu" aria-expanded="false"
        aria-label="Open main menu" onclick="toggleNav()">
        <!-- accessible SVG hamburger -->
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>

      <div style="display:flex;align-items:center;gap:12px;">
        <div class="nav-logo" style="color:white;font-weight:700;">Scholars Academy</div>
      </div>

      <div class="nav-inline" id="navInline" style="margin-left:auto;">
        <button class="nav-btn active" onclick="showSection('attendanceSection', this)">üìò Attendance</button>
        <button class="nav-btn" onclick="showSection('marksSection', this)">üìù Test Marks</button>
        <button class="nav-btn" onclick="showSection('analyticsSection', this)">üìä Students Analytics</button>
        <button class="nav-btn" onclick="logIn()">Log In</button>
        <button class="nav-btn" onclick="logOut()">Log Out</button>
        <button class="nav-btn" onclick="downloadCSV()"><svg style="position: relative; top: 3px; right:8px"
            xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"
            focusable="false">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>Download Monthly Attendance</button>
      </div>

    </nav>

    <!-- mobile slide-in menu -->
    <div id="navMenu" class="nav-menu" aria-hidden="true">
      <button class="nav-btn" onclick="menuNavClick('attendanceSection', this)">üìò Attendance</button>
      <button class="nav-btn" onclick="menuNavClick('marksSection', this)">üìù Test Marks</button>
      <button class="nav-btn" onclick="menuNavClick('analyticsSection', this)">üìä Students Analytics</button>
      <button class="nav-btn" onclick="logIn()">Log In</button>
      <button class="nav-btn" onclick="logOut()">Log Out</button>
      <button class="nav-btn" onclick="downloadCSV()"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
          stroke-linejoin="round" aria-hidden="true" focusable="false">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="7 10 12 15 17 10" />
          <line x1="12" y1="15" x2="12" y2="3" />
        </svg><span> </span>Download Monthly Attendance</button>
    </div>
    <div id="navOverlay" class="nav-overlay" role="presentation" onclick="closeNavFromOverlay()"></div>
  </header>

  <!-- ===== LOGIN VALIDATION MODAL (appears on page load) ===== -->
  <div id="authOverlay" class="auth-overlay" aria-hidden="false">
    <div class="auth-modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <h2 id="authTitle">Teacher Sign In</h2>
      <p>Please enter your name and passcode to continue</p>
      <input id="teacherNameInput" type="text" placeholder="Username" autocomplete="off" />
      <input id="teacherPassInput" type="password" placeholder="Passcode" autocomplete="off" />
      <button id="authSignBtn">Sign In</button>
      <div class="auth-hint">Contact Mubashir if you don't have credentials.</div>
    </div>
  </div>
  <!-- ======================================================= -->

  <!-- Processing modal (used by login/logout flow) -->
  <div id="processingOverlay" aria-hidden="true" role="status" aria-live="polite">
    <div class="processing-modal" role="dialog" aria-modal="true" aria-labelledby="processingTitle">
      <div class="processing-spinner" aria-hidden="true"></div>
      <div>
        <div id="processingTitle" class="processing-text">Processing‚Ä¶</div>
        <div id="processingSub" class="processing-sub">Please wait</div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Attendance Section -->
    <div id="attendanceSection" class="section active">
      <div class="logo-wrap">
        <img src="logo.jpg" alt="Scholars Academy logo" class="class-logo" loading="lazy"
          onerror="this.style.display='none'" width="100%" height="10%">
      </div>
      <div class="class-buttons" id="classButtons">
        <h2>Mark Attendance</h2>
        <h2 style="width:100%; text-align:center; margin:0 0 8px 0; font-size:16px;">Select Class</h2>
        <button onclick="loadClass('5th ICSE')">5th ICSE</button>
        <button onclick="loadClass('6th ICSE')">6th ICSE</button>
        <button onclick="loadClass('7th ICSE')">7th ICSE</button>
        <button onclick="loadClass('8th ICSE')">8th ICSE</button>
        <button onclick="loadClass('9th ICSE')">9th ICSE</button>
        <button onclick="loadClass('10th ICSE')">10th ICSE</button>
        <button onclick="loadClass('9th Symbiosis')">9th SYM</button>
        <button onclick="loadClass('9th General')">9th GEN</button>
        <button onclick="loadClass('10th SSC')">10th SSC</button>
      </div>
      <div class="students-list" id="studentsList"></div>
      <div class="summary-section">
        <button onclick="generateResult()">Get Result</button>
        <button onclick="clearResult()">Clear Summary</button>
        <!-- NEW: Submit Attendance button -->
        <button id="submitAttendanceBtn" onclick="submitAttendance()">Submit Attendance</button>

        <textarea id="summary" placeholder="Absent and present students will appear here..." readonly></textarea>
        <button id="shareBtn" onclick="shareOnWhatsApp()">Share on WhatsApp</button>
        <button id="downloadImageBtn" onclick="downloadAttendanceImage()">Download Image</button>
      </div>
    </div>

    <!-- Test Marks Section -->
    <div id="marksSection" class="section">
      <div class="logo-wrap">
        <img src="logo.jpg" alt="Scholars Academy logo" class="class-logo" loading="lazy"
          onerror="this.style.display='none'" width="100%" height="10%">
      </div>
      <h1>Test Marks</h1>
      <div class="class-buttons" style="margin-bottom:6px;">
        <h2 style="width:100%; text-align:center; margin:0 0 8px 0; font-size:16px;">Select Class</h2>
        <button onclick="loadClass('5th ICSE')">5th ICSE</button>
        <button onclick="loadClass('6th ICSE')">6th ICSE</button>
        <button onclick="loadClass('7th ICSE')">7th ICSE</button>
        <button onclick="loadClass('8th ICSE')">8th ICSE</button>
        <button onclick="loadClass('9th ICSE')">9th ICSE</button>
        <button onclick="loadClass('10th ICSE')">10th ICSE</button>
        <button onclick="loadClass('9th Symbiosis')">9th SYM</button>
        <button onclick="loadClass('9th General')">9th GEN</button>
        <button onclick="loadClass('10th SSC')">10thSSC</button>
      </div>
      <div class="marks-meta" style="max-width:960px; margin:0 auto 6px;">
        <input id="subjectInput" placeholder="Subject name (e.g. Physics)" />
        <input id="chapterInput" placeholder="Chapter (e.g. Chapter 3: Laws)" />
        <input id="totalMarksInput" placeholder="Total Marks (e.g. 20)" type="number" min="1"
          oninput="onTotalMarksChange()" />
      </div>
      <div class="students-list" id="marksStudentsList" style="max-width:960px; margin: 10px auto;"></div>
      <div class="summary-section">
        <button onclick="generateMarksResult()">Generate Marks</button>
        <button onclick="clearMarksResult()">Clear Summary</button>
        <textarea id="marksSummary" placeholder="Students' marks will appear here..." readonly></textarea>
        <button id="shareMarksBtn" onclick="shareMarksOnWhatsApp()">Share on WhatsApp</button>
      </div>
    </div>

    <!-- NEW: Students Analytics Section -->
    <div id="analyticsSection" class="section">
      <div class="logo-wrap">
        <img src="logo.jpg" alt="Scholars Academy logo" class="class-logo" loading="lazy"
          onerror="this.style.display='none'" width="100%" height="10%">
      </div>
      <h1>Analytics</h1>
      <div class="class-buttons" style="margin-bottom:6px;">
        <h2 style="width:100%; text-align:center; margin:0 0 8px 0; font-size:16px;">Select Class</h2>
        <button onclick="loadClass('5th ICSE')">5th ICSE</button>
        <button onclick="loadClass('6th ICSE')">6th ICSE</button>
        <button onclick="loadClass('7th ICSE')">7th ICSE</button>
        <button onclick="loadClass('8th ICSE')">8th ICSE</button>
        <button onclick="loadClass('9th ICSE')">9th ICSE</button>
        <button onclick="loadClass('10th ICSE')">10th ICSE</button>
        <button onclick="loadClass('9th Symbiosis')">9th SYM</button>
        <button onclick="loadClass('9th General')">9th GEN</button>
        <button onclick="loadClass('10th SSC')">10thSSC</button>
      </div>

      <div class="students-list" id="analyticsStudentsList" style="max-width:960px; margin: 10px auto;"></div>
    </div>
  </div>

  <!-- Student details modal (analytics) -->
  <div id="studentDetailsModal" class="student-modal-overlay" role="dialog" aria-modal="true"
    aria-labelledby="studentDetailsTitle">
    <div class="student-modal" role="document">
      <h3 id="studentDetailsTitle">Student Details</h3>
      <div id="studentDetailsContent">
        <!-- Filled by JS -->
      </div>

      <!-- NEW: Share button on the left of Close -->
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
        <button id="shareToParentsBtn" class="close-btn" style="background: green;" onclick="shareStudentFromModal()"
          aria-label="Share attendance to parents">
          Share to Parents
        </button>
        <button class="close-btn" onclick="hideStudentDetailsModal()">Close</button>
      </div>

    </div>
  </div>

  <!-- NOTE: script.js is loaded as a module so it can import Firebase -->
  <!-- <script type="module" src="firebase.js"></script> -->
  <script src="studentDetails.js"></script>
  <script src="cVbHHn6.js"></script>
  <script src="script.js"></script>
  <script src="actions.js"></script>
  <script src="coreFunctions.js"></script>
  <script src="logatt.js"></script>

  <footer>¬© 2025 Developed By Mubashir. All rights reserved.</footer>
</body>

</html>
